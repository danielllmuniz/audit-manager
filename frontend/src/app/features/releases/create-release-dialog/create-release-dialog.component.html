<h2 mat-dialog-title>New Release</h2>

<mat-dialog-content>
  <form [formGroup]="releaseForm" class="release-form">
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Application</mat-label>
      <mat-select formControlName="applicationId" required>
        <mat-option *ngFor="let app of applications" [value]="app.id || app.application_id">
          {{ app.name }}
        </mat-option>
      </mat-select>
      <mat-icon matPrefix>apps</mat-icon>
      @if (releaseForm.get('applicationId')?.hasError('required') && releaseForm.get('applicationId')?.touched) {
        <mat-error>Application is required</mat-error>
      }
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Version</mat-label>
      <input
        matInput
        formControlName="version"
        placeholder="Ex: 1.0.0, v2.3.1"
        required>
      <mat-icon matPrefix>tag</mat-icon>
      <mat-hint>Use semantic versioning (ex: 1.0.0)</mat-hint>
      @if (releaseForm.get('version')?.hasError('required') && releaseForm.get('version')?.touched) {
        <mat-error>Version is required</mat-error>
      }
      @if (releaseForm.get('version')?.hasError('pattern')) {
        <mat-error>Invalid format (use: 1.0.0 or v1.0.0)</mat-error>
      }
    </mat-form-field>

    <mat-card class="info-card">
      <mat-card-content>
        <div class="info-section">
          <mat-icon color="primary">info</mat-icon>
          <div class="info-text">
            <strong>Next steps after creation:</strong>
            <ul>
              <li>Release will be created in <strong>DEV</strong> environment</li>
              <li>Automatic security validations will run</li>
              <li>If approved, status will change to <strong>PENDING_PREPROD</strong></li>
              <li>An Approver will need to approve before promotion</li>
            </ul>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button
    mat-button
    mat-dialog-close
    [disabled]="saving">
    Cancel
  </button>
  <button
    mat-raised-button
    color="primary"
    (click)="onSubmit()"
    [disabled]="releaseForm.invalid || saving">
    @if (saving) {
      <mat-spinner diameter="20" class="button-spinner"></mat-spinner>
      <span>Creating...</span>
    } @else {
      <ng-container>
        <mat-icon>rocket_launch</mat-icon>
        <span>Create Release</span>
      </ng-container>
    }
  </button>
</mat-dialog-actions>